<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html"
      lang="eng">
<head th:insert="partials/header :: head"/>
<link rel="stylesheet" th:href="@{/css/menu.css}">
<body>
<div th:replace="partials/navbar :: navbar"/>

<div class="menu-header">
    <h1>OUR MENU</h1>
    <div class="menu-categories">
        <p><a class="menu-category-title" href="#appetizers">APPETIZERS</a></p>
        <p><a class="menu-category-title" href="#entrees">ENTREES</a></p>
        <p><a class="menu-category-title" href="#sides">SIDES</a></p>
        <p><a class="menu-category-title" href="#salsas">SALSAS</a></p>
        <p><a class="menu-category-title" href="#beverages">BEVERAGES</a></p>
    </div>
</div>

<div class="container-xxl">
    <!--    <div class="menu">-->
    <!---------------------for each menu item--------------------------->
    <!-- APPETIZERS -> CHIPS -->
    <p class="mainCategory" id="appetizers">Appetizers</p>
    <p class="subCategory">Chips</p>
    <div class="menu">
        <div th:each="item : ${menuItems}">
            <div th:if="${item.mainCategory.name() =='APPETIZERS' && item.subCategory.name() == 'CHIPS'}">
                <div class="menu-item">
                    <div class="menu-item-info">
                        <p class="menu-item-title"><span th:text="${item.item_name}"></span> - $<span
                                th:text="${item.price}"></span></p>
                        <p class="menu-item-description" th:text="${item.description}"></p>
                        <div class="menu-item-buttons">
                            <p class="menu-item-view-more"><a class="view-more-link"
                                                              th:attr="href=${'/view-more/' + item.id}">View More</a>
                            </p>
                            <p><button type="button" class="menu-item-add-to-bag" data-bs-toggle="modal" th:attr="data-bs-target=${'#optionsModal' + item.id}">
                                Add to bag
                            </button></p>
                        </div>
                    </div>
                    <div class="img-div">
                        <img class="menu-item-image" src="/img/placeholder.png">
                    </div>
                </div>
            </div> <!-- end if statement -->
        </div> <!-- end for each -->
    </div>

    <!-- APPETIZERS -> OTHER -->
    <p class="subCategory">Other</p>
    <div class="menu">
        <div th:each="item : ${menuItems}">
            <div th:if="${item.mainCategory.name() =='APPETIZERS' && item.subCategory.name() == 'OTHER'}">
                <div class="menu-item">
                    <div class="menu-item-info">
                        <p class="menu-item-title"><span th:text="${item.item_name}"></span> - $<span
                                th:text="${item.price}"></span></p>
                        <p class="menu-item-description" th:text="${item.description}"></p>
                        <div class="menu-item-buttons">
                            <p class="menu-item-view-more"><a class="view-more-link"
                                                              th:attr="href=${'/view-more/' + item.id}">View More</a>
                            </p>
                            <p><button type="button" class="menu-item-add-to-bag" data-bs-toggle="modal" th:attr="data-bs-target=${'#optionsModal' + item.id}">
                                Add to bag
                            </button></p>
                        </div>
                    </div>
                    <div class="img-div">
                        <img class="menu-item-image" src="/img/placeholder.png">
                    </div>
                </div>
            </div> <!-- end if statement -->
        </div> <!-- end for each -->
    </div>

    <!-- ENTREES -->
    <div class="menu">
        <p class="mainCategory" id="entrees">Entrees</p>
        <div th:each="item : ${menuItems}">
            <div th:if="${item.mainCategory.name() == 'ENTREES'}">

                <div class="menu-item">
                    <div class="menu-item-info">
                        <p class="menu-item-title"><span th:text="${item.item_name}"></span> - $<span
                                th:text="${item.price}"></span></p>
                        <p class="menu-item-description" th:text="${item.description}"></p>
                        <div class="menu-item-buttons">
                            <p class="menu-item-view-more"><a class="view-more-link"
                                                              th:attr="href=${'/view-more/' + item.id}">View More</a>
                            </p>
                            <p><button type="button" class="menu-item-add-to-bag" data-bs-toggle="modal" th:attr="data-bs-target=${'#optionsModal' + item.id}">
                                Add to bag
                            </button></p>
                        </div>
                    </div>
                    <div class="img-div">
                        <img class="menu-item-image" src="/img/placeholder.png">
                    </div>
                </div>

            </div> <!-- end if statement -->
        </div> <!-- end for each -->
    </div>


    <!-- SIDES -->
    <p class="mainCategory" id="sides">Sides</p>
    <div class="menu">
        <div th:each="item : ${menuItems}">
            <div th:if="${item.mainCategory.name() =='SIDES'}">
                <div class="menu-item">
                    <div class="menu-item-info">
                        <p class="menu-item-title"><span th:text="${item.item_name}"></span> - $<span
                                th:text="${item.price}"></span></p>
                        <p class="menu-item-description" th:text="${item.description}"></p>
                        <div class="menu-item-buttons">
                            <p class="menu-item-view-more"><a class="view-more-link"
                                                              th:attr="href=${'/view-more/' + item.id}">View More</a>
                            </p>
                            <p><button type="button" class="menu-item-add-to-bag" data-bs-toggle="modal" th:attr="data-bs-target=${'#optionsModal' + item.id}">
                                Add to bag
                            </button></p>
                        </div>
                    </div>
                    <div class="img-div">
                        <img class="menu-item-image" src="/img/placeholder.png">
                    </div>
                </div>
            </div> <!-- end if statement -->
        </div> <!-- end for each -->
    </div>

    <!-- SALSAS -->
    <p class="mainCategory" id="salsas">salsas</p>
    <div class="menu">
        <div th:each="item : ${menuItems}">
            <div th:if="${item.mainCategory.name() =='SALSAS'}">
                <div class="menu-item">
                    <div class="menu-item-info">
                        <p class="menu-item-title"><span th:text="${item.item_name}"></span> - $<span
                                th:text="${item.price}"></span></p>
                        <p class="menu-item-description" th:text="${item.description}"></p>
                        <div class="menu-item-buttons">
                            <p class="menu-item-view-more"><a class="view-more-link"
                                                              th:attr="href=${'/view-more/' + item.id}">View More</a>
                            </p>
                            <p><button type="button" class="menu-item-add-to-bag" data-bs-toggle="modal" th:attr="data-bs-target=${'#optionsModal' + item.id}">
                                Add to bag
                            </button></p>
                        </div>
                    </div>
                    <div class="img-div">
                        <img class="menu-item-image" src="/img/placeholder.png">
                    </div>
                </div>
            </div> <!-- end if statement -->
        </div> <!-- end for each -->
    </div>

    <!-- BEVERAGES -> SODAS -->
    <p class="mainCategory" id="beverages">Beverages</p>
    <p class="subCategory">Sodas</p>
    <div class="menu">
        <div th:each="item : ${menuItems}">
            <div th:if="${item.mainCategory.name() =='BEVERAGES' && item.subCategory.name() == 'SODAS'}">
                <div class="menu-item">
                    <div class="menu-item-info">
                        <p class="menu-item-title"><span th:text="${item.item_name}"></span> - $<span
                                th:text="${item.price}"></span></p>
                        <p class="menu-item-description" th:text="${item.description}"></p>
                        <div class="menu-item-buttons">
                            <p class="menu-item-view-more"><a class="view-more-link"
                                                              th:attr="href=${'/view-more/' + item.id}">View More</a>
                            </p>
                            <p><button type="button" class="menu-item-add-to-bag" data-bs-toggle="modal" th:attr="data-bs-target=${'#optionsModal' + item.id}">
                                Add to bag
                            </button></p>
                        </div>
                    </div>
                    <div class="img-div">
                        <img class="menu-item-image" src="/img/placeholder.png">
                    </div>
                </div>
            </div> <!-- end if statement -->
        </div> <!-- end for each -->
    </div>

    <!--  BEVERAGES -> AGUA FRESCAS -->
    <p class="subCategory">Agua Frescas</p>
    <div class="menu">
        <div th:each="item : ${menuItems}">
            <div th:if="${item.mainCategory.name() =='BEVERAGES' && item.subCategory.name() == 'AGUAFRESCAS'}">
                <div class="menu-item">
                    <div class="menu-item-info">
                        <p class="menu-item-title"><span th:text="${item.item_name}"></span> - $<span
                                th:text="${item.price}"></span></p>
                        <p class="menu-item-description" th:text="${item.description}"></p>
                        <div class="menu-item-buttons">
                            <p class="menu-item-view-more"><a class="view-more-link"
                                                              th:attr="href=${'/view-more/' + item.id}">View More</a>
                            </p>
                            <p><button type="button" class="menu-item-add-to-bag" data-bs-toggle="modal" th:attr="data-bs-target=${'#optionsModal' + item.id}">
                                Add to bag
                            </button></p>
                        </div>
                    </div>
                    <div class="img-div">
                        <img class="menu-item-image" src="/img/placeholder.png">
                    </div>
                </div>
            </div> <!-- end if statement -->
        </div> <!-- end for each -->
    </div>

    <!--  BEVERAGES -> COFFEE -->
    <p class="subCategory">COFFEE</p>
    <div class="menu">
        <div th:each="item : ${menuItems}">
            <div th:if="${item.mainCategory.name() =='BEVERAGES' && item.subCategory.name() == 'COFFEE'}">
                <div class="menu-item">
                    <div class="menu-item-info">
                        <p class="menu-item-title"><span th:text="${item.item_name}"></span> - $<span
                                th:text="${item.price}"></span></p>
                        <p class="menu-item-description" th:text="${item.description}"></p>
                        <div class="menu-item-buttons">
                            <p class="menu-item-view-more"><a class="view-more-link"
                                                              th:attr="href=${'/view-more/' + item.id}">View More</a>
                            </p>
                            <p><button type="button" class="menu-item-add-to-bag" data-bs-toggle="modal" th:attr="data-bs-target=${'#optionsModal' + item.id}">
                                Add to bag
                            </button></p>
                        </div>
                    </div>
                    <div class="img-div">
                        <img class="menu-item-image" src="/img/placeholder.png">
                    </div>
                </div>
            </div> <!-- end if statement -->
        </div> <!-- end for each -->
    </div>

    <!--  BEVERAGES -> OTHER -->
    <div class="menu">
        <p class="subCategory">Other</p>
        <div th:each="item : ${menuItems}">
            <div th:if="${item.mainCategory.name() =='BEVERAGES' && item.subCategory.name() == 'OTHER'}">
                <div class="menu-item">
                    <div class="menu-item-info">
                        <p class="menu-item-title"><span th:text="${item.item_name}"></span> - $<span
                                th:text="${item.price}"></span></p>
                        <p class="menu-item-description" th:text="${item.description}"></p>
                        <div class="menu-item-buttons">
                            <p class="menu-item-view-more"><a class="view-more-link"
                                                              th:attr="href=${'/view-more/' + item.id}">View More</a>
                            </p>
                            <p><button type="button" class="menu-item-add-to-bag" data-bs-toggle="modal" th:attr="data-bs-target=${'#optionsModal' + item.id}">
                                Add to bag
                            </button></p>
                        </div>
                    </div>
                    <div class="img-div">
                        <img class="menu-item-image" src="/img/placeholder.png">
                    </div>
                </div>
            </div> <!-- end if statement -->
        </div> <!-- end for each -->
    </div>
    <!------------------------------------------------------------------>

    <!--    </div>-->
</div>

<!--Creating modals -->
<div th:each="item : ${menuItems}">

    <!-- Modal -->
    <div class="modal fade" th:attr="id=${'optionsModal' + item.id}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel" th:text="${item.item_name}"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!--          <h5 th:text="${item.item_name}"></h5>-->
                    <div th:if="${item.meatReq.name() =='YES'}">
                        <h6>Chose your meat (1 choice required)</h6>
                        <div th:each="option : ${item.menuItemOptions}">
                            <div th:if="${option.getOptionCategory().name() == 'MEAT'}">
                                <input type="radio" th:id="${'meatOptions' + item.id}" th:attr="name=${'meatOptions' + item.id}" th:value="${option.getOption_name()}">
                                <label th:for="${option.getOption_name()}"><span th:text="${option.getOption_name()}"></span></label><br>
                            </div>
                        </div>
                    </div>
                    <div th:if="${item.toppingsReq.name() =='YES'}">
                        <h6>Chose your toppings</h6>
                        <div th:each="option : ${item.menuItemOptions}">
                            <div th:if="${option.getOptionCategory().name() == 'TOPPING'}">
                                <input type="checkbox" th:id="${'toppingOptions' + item.id}" th:attr="name=${'toppingOptions' + item.id}" th:value="${option.getOption_name()}">
                                <label th:for="${option.getOption_name()}"><span th:text="${option.getOption_name()}"></span></label><br>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center">
                        <!--  !!!   IMPORTANT !!! -->
                        <!--  DO NOT REMOVE, CHANGE, OR ADD THE CLASSES 'minusQuantity', 'currentQuantity', 'addQuantity', 'addToBag' AMONGST ANY ELEMENTS -->
                        <h6>Quantity:</h6>
                        <button class="minusQuantity" th:id="${'minusQuantity' + item.id}">-</button>
                        <p th:id="${'currentQuantity' + item.id}">1</p>
                        <button  class="addQuantity"  th:id="${'addQuantity' + item.id}">+</button>
                    </div>
                    <div th:id="${'feedback' + item.id}"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" th:id="${'addToBag' + item.id}" class="btn btn-primary addToBag">Add to bag</button>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    function handleMinusClick(event) {
        const buttonId = event.target.id;
        let itemId = parseInt(buttonId.toString().substring(13));
        let quantityDisplay = document.getElementById("currentQuantity" + itemId);
        let quantity = parseInt(quantityDisplay.innerText);
        if(quantity > 0) {
            quantity = quantity - 1;
            quantityDisplay.innerText = quantity.toString();
        }

    }
    function handleAddQuantityClick(event) {
        const buttonId = event.target.id;
        let itemId = parseInt(buttonId.toString().substring(11));
        let quantityDisplay = document.getElementById("currentQuantity" + itemId);
        let quantity = parseInt(quantityDisplay.innerText);
        quantity = quantity + 1;
        quantityDisplay.innerText = quantity.toString();
    }

    function handleAddToBagClick(event) {
        let  buttonId = event.target.id;
        let itemId = parseInt(buttonId.toString().substring(8));
        let feedback = document.getElementById('feedback' + itemId);
        let quantityDisplay = document.getElementById("currentQuantity" + itemId);
        let quantity = quantityDisplay.innerText;
        let options = [];

        let selectedMeat = getSelectedMeats(itemId);
        let selectedToppings = getSelectedToppings(itemId);

        if (selectedMeat == null) {
            feedback.innerText = "Please choose a meat before proceeding";
        } else {
            options = selectedToppings.slice();
            if(selectedMeat != "") {
                options.unshift(selectedMeat);
            }
            let optionList = options.toString();
            window.location.href = "addToBag?menuItem=" + itemId + "&quantity=" + quantity + "&options=" + optionList;
        }


    }

    function getSelectedMeats(itemId) {
        let radioButtonGroup = document.getElementsByName('meatOptions' + itemId);

        if (radioButtonGroup.length === 0) {
            //this is for if there is no meat required
            return "";
        }

        //find the option selected
        for (const radioButton of radioButtonGroup) {
            if (radioButton.checked) {
                return radioButton.value
            }
        }

        //if nothing is selected
        return null;
    }

    function getSelectedToppings(itemId) {
        let checkboxesGroup = document.getElementsByName('toppingOptions' + itemId);
        let selectedValues = [];

        //add all selected items to array
        for (const checkbox of checkboxesGroup) {
            if (checkbox.checked) {
                selectedValues.push(checkbox.value);
            }
        }
        return selectedValues;
    }


    const qMinusButtons = document.querySelectorAll('.minusQuantity');
    qMinusButtons.forEach(button => {
        button.addEventListener('click', handleMinusClick);
    });

    const qAddButtons = document.querySelectorAll('.addQuantity');
    qAddButtons.forEach(button => {
        button.addEventListener('click', handleAddQuantityClick);
    });

    const addToBagButtons = document.querySelectorAll('.addToBag');
    addToBagButtons.forEach(button => {
        button.addEventListener('click', handleAddToBagClick);
    });
</script>

<div th:insert="partials/footer :: footer"/>
</body>
</html>